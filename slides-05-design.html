<!DOCTYPE html>
<html lang="en"><head>
<link href="./images/favicon.png" rel="icon" type="image/png">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-57476271c5f0467c372e20ff5d25630e.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>useR 2025 – Sampling Designs in {srvyr}</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #383a42;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #383a42; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #50a14f; } /* Annotation */
    code span.at { color: #a626a4; } /* Attribute */
    code span.bn { color: #986801; } /* BaseN */
    code span.bu { color: #a626a4; } /* BuiltIn */
    code span.cf { color: #a626a4; } /* ControlFlow */
    code span.ch { color: #50a14f; } /* Char */
    code span.cn { color: #986801; } /* Constant */
    code span.co { color: #a0a1a7; font-style: italic; } /* Comment */
    code span.cv { color: #e45649; font-style: italic; } /* CommentVar */
    code span.do { color: #e45649; } /* Documentation */
    code span.dt { color: #a626a4; } /* DataType */
    code span.dv { color: #986801; } /* DecVal */
    code span.er { color: #f44747; text-decoration: underline; } /* Error */
    code span.ex { color: #4078f2; font-weight: bold; } /* Extension */
    code span.fl { color: #986801; } /* Float */
    code span.fu { color: #4078f2; } /* Function */
    code span.im { color: #50a14f; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #a626a4; } /* Keyword */
    code span.op { color: #a626a4; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #a626a4; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #0184bc; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #50a14f; } /* String */
    code span.va { color: #e45649; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-8164cf76d6be4ed125fa33063385f9fc.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="site_libs/countdown-0.4.0/countdown.css" rel="stylesheet">
  <script src="site_libs/countdown-0.4.0/countdown.js"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background="#087e8b" class="quarto-title-block center">
  <h1 class="title">Sampling Designs in {srvyr}</h1>

<div class="quarto-title-authors">
</div>

</section>
<section>
<section id="sampling-designs" class="title-slide slide level1 center" data-background-color="#087e8b">
<h1>Sampling designs</h1>

</section>
<section id="sampling-methods" class="slide level2">
<h2>Sampling methods</h2>
<p>Units can be selected in various ways such as:</p>
<ul>
<li><p><strong>Simple random sampling (with or without replacement):</strong> every unit has the same chance of being selected</p></li>
<li><p><strong>Systematic sampling:</strong> sample individuals from an ordered list and sampling individuals at an interval with a random starting point</p></li>
<li><p><strong>Probability proportional to size:</strong> probability of selection is proportional to “size”</p></li>
</ul>
</section>
<section id="complex-designs" class="slide level2">
<h2>Complex designs</h2>
<p>Designs can also incorporate stratification and/or clustering:</p>
<ul>
<li><p><strong>Stratified sampling:</strong> divide population into mutually exclusive subgroups (strata). Randomly sample within each stratum</p></li>
<li><p><strong>Clustered sampling:</strong> divide population into mutually exclusive subgroups (clusters). Randomly sample clusters and then individuals within clusters</p></li>
</ul>
</section>
<section id="why-design-matters" class="slide level2">
<h2>Why design matters?</h2>
<ul>
<li><p>The design type impacts the variability of the estimates</p></li>
<li><p>Weights impact the point estimate and the variability estimates</p></li>
<li><p>Specifying the components of the design (strata and/or clusters) and weights in R is necessary to get correct estimates</p></li>
</ul>
</section>
<section id="determining-the-design" class="slide level2 smaller">
<h2>Determining the design</h2>
<div>
<ul>
<li class="fragment"><p>Check the documentation such as methodology, design, analysis guide, or technical documentation</p></li>
<li class="fragment"><p>Documentation will indicate the variables needed to specify the design. Look for:</p>
<ul>
<li class="fragment">weight (almost always)</li>
<li class="fragment">strata and/or clusters/PSUs. Sometimes pseudo-strata and pseudo-cluster OR</li>
<li class="fragment">replicate weights (this is used instead of strata/clusters for analysis)</li>
<li class="fragment">Finite population correction or population sizes (uncommon)</li>
</ul></li>
<li class="fragment"><p>Documentation may include SAS, SUDAAN, Stata and/or R syntax</p></li>
</ul>
</div>
<aside class="notes">
<ul>
<li>We will show both ANES and RECS examples when diving into code</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="specifying-sampling-designs-in-srvyr-without-replicate-weights" class="title-slide slide level1 center" data-background-color="#087e8b">
<h1>Specifying sampling designs in {srvyr} <strong>without</strong> replicate weights</h1>

</section>
<section id="as_survey_design-syntax" class="slide level2">
<h2><code>as_survey_design()</code>: Syntax</h2>
<ul>
<li><p>Specifying the sampling design when you don’t have replicate weights</p></li>
<li><p><code>as_survey_design()</code> creates a <code>tbl_svy</code> object that then correctly calculates weighted estimates and SEs</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">as_survey_design</span>(</span>
<span id="cb1-2"><a></a>  .data,</span>
<span id="cb1-3"><a></a>  <span class="at">ids =</span> <span class="cn">NULL</span>, <span class="co"># cluster IDs/PSUs</span></span>
<span id="cb1-4"><a></a>  <span class="at">strata =</span> <span class="cn">NULL</span>, <span class="co"># strata variables</span></span>
<span id="cb1-5"><a></a>  <span class="at">variables =</span> <span class="cn">NULL</span>, <span class="co"># defaults to all in .data</span></span>
<span id="cb1-6"><a></a>  <span class="at">fpc =</span> <span class="cn">NULL</span>, <span class="co"># variables defining the fpc</span></span>
<span id="cb1-7"><a></a>  <span class="at">nest =</span> <span class="cn">FALSE</span>, <span class="co"># TRUE/FALSE - relabel clusters to nest within strata</span></span>
<span id="cb1-8"><a></a>  <span class="at">check_strata =</span> <span class="sc">!</span>nest, <span class="co"># check that clusters are nested in strata</span></span>
<span id="cb1-9"><a></a>  <span class="at">weights =</span> <span class="cn">NULL</span> <span class="co"># weight variable,</span></span>
<span id="cb1-10"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="syntax-for-common-designs" class="slide level2 smaller">
<h2>Syntax for common designs</h2>
<p>Load in the example data from {survey} package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="fu">data</span>(api, <span class="at">package=</span><span class="st">"survey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Simple Random Sample (SRS)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>apisrs <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">fpc =</span> fpc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Stratified SRS</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>apistrat <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">strata =</span> stype, <span class="at">weights =</span> pw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>One-stage cluster sample with a FPC variable</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>apiclus1 <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">ids =</span> dnum, <span class="at">weights =</span> pw, <span class="at">fpc =</span> fpc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Two-stage cluster sample, weights computed from population size</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>apiclus2 <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">ids =</span> <span class="fu">c</span>(dnum, snum), <span class="at">fpc =</span> <span class="fu">c</span>(fpc1, fpc2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Stratified, cluster design</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>apistrat <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">ids =</span> dnum, <span class="at">strata =</span> stype, <span class="at">weights =</span>pw, <span class="at">nest =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<aside><div>
<p>Examples from <code>srvyr</code> help documentation</p>
</div></aside></section></section>
<section>
<section id="example" class="title-slide slide level1 center" data-background-color="#0b3954">
<h1>Example</h1>

</section>
<section id="example-anes-2020" class="slide level2 smaller">
<h2>Example: ANES 2020</h2>
<ul>
<li>User Guide and Codebook<sup>1</sup> : Section “Data Analysis, Weights, and Variance Estimation” includes information on weights and strata/cluster variables</li>
</ul>
<blockquote>
<p>For analysis of the complete set of cases using pre-election data only, including all cases and representative of the 2020 electorate, use the full sample pre-election weight, <strong>V200010a</strong>. For analysis including post-election data for the complete set of participants (i.e., analysis of post-election data only or a combination of pre- and post-election data), use the full sample post-election weight, <strong>V200010b</strong>. Additional weights are provided for analysis of subsets of the data, as follows.</p>
</blockquote>
<table class="caption-top">
<thead>
<tr class="header">
<th>For weight</th>
<th>Use variance unit/PSU/cluster</th>
<th>and use variance stratum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>V200010a</td>
<td>V200010c</td>
<td>V200010d</td>
</tr>
<tr class="even">
<td>V200010b</td>
<td>V200010c</td>
<td>V200010d</td>
</tr>
</tbody>
</table>
<aside><ol class="aside-footnotes"><li id="fn1"><p><a href="https://electionstudies.org/data-center/2020-time-series-study/" class="uri">https://electionstudies.org/data-center/2020-time-series-study/</a></p></li></ol></aside></section>
<section id="example-anes-2020-syntax" class="slide level2">
<h2>Example: ANES 2020 Syntax</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-8-1"><a href="#annotated-cell-8-1"></a>anes <span class="ot">&lt;-</span> anes_2020 <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-8-2" class="code-annotation-target"><a href="#annotated-cell-8-2"></a>  <span class="fu">mutate</span>(<span class="at">Weight =</span> V200010b <span class="sc">/</span> <span class="fu">sum</span>(V200010b) <span class="sc">*</span> <span class="dv">231592693</span>)</span>
<span id="annotated-cell-8-3"><a href="#annotated-cell-8-3"></a></span>
<span id="annotated-cell-8-4"><a href="#annotated-cell-8-4"></a>anes_des <span class="ot">&lt;-</span> anes <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-8-5"><a href="#annotated-cell-8-5"></a>  <span class="fu">as_survey_design</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-8-6" class="code-annotation-target"><a href="#annotated-cell-8-6"></a>    <span class="at">weights =</span> Weight,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-8-7" class="code-annotation-target"><a href="#annotated-cell-8-7"></a>    <span class="at">strata =</span> V200010d,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-8-8" class="code-annotation-target"><a href="#annotated-cell-8-8"></a>    <span class="at">ids =</span> V200010c,</span>
<span id="annotated-cell-8-9"><a href="#annotated-cell-8-9"></a>    <span class="at">nest =</span> <span class="cn">TRUE</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-8-10" class="code-annotation-target"><a href="#annotated-cell-8-10"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="2" data-code-annotation="1">Adjust the weight of the ANES data to reflect the national population</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="6" data-code-annotation="2">Specify the weight variable</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="7" data-code-annotation="3">Specify the strata variable per documentation</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="8" data-code-annotation="4">Specify the cluster variable per documentation</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="10" data-code-annotation="5">Indicate that the clusters are nested within strata</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="example-anes-2020-design" class="slide level2">
<h2>Example: ANES 2020 Design</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="fu">summary</span>(anes_des)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stratified 1 - level Cluster Sampling design (with replacement)
With (101) clusters.
Called via srvyr
Probabilities:
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
4.839e-06 2.657e-05 4.689e-05 7.688e-05 8.331e-05 3.895e-03 
Stratum Sizes: 
             1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16
obs        167 148 158 151 147 172 163 159 160 159 137 179 148 160 159 148
design.PSU   3   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
actual.PSU   3   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
            17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
obs        158 156 154 144 170 146 165 147 169 165 172 133 157 167 154 143
design.PSU   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
actual.PSU   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
            33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48
obs        143 124 138 130 136 145 140 125 158 146 130 126 126 135 133 140
design.PSU   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
actual.PSU   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
            49  50
obs        133 130
design.PSU   2   2
actual.PSU   2   2
Data variables:
 [1] "V200001"                 "CaseID"                 
 [3] "V200002"                 "InterviewMode"          
 [5] "V200010b"                "Weight"                 
 [7] "V200010c"                "VarUnit"                
 [9] "V200010d"                "Stratum"                
[11] "V201006"                 "CampaignInterest"       
[13] "V201023"                 "EarlyVote2020"          
[15] "V201024"                 "V201025x"               
[17] "V201028"                 "V201029"                
[19] "V201101"                 "V201102"                
[21] "VotedPres2016"           "V201103"                
[23] "VotedPres2016_selection" "V201228"                
[25] "V201229"                 "V201230"                
[27] "V201231x"                "PartyID"                
[29] "V201233"                 "TrustGovernment"        
[31] "V201237"                 "TrustPeople"            
[33] "V201507x"                "Age"                    
[35] "AgeGroup"                "V201510"                
[37] "Education"               "V201546"                
[39] "V201547a"                "V201547b"               
[41] "V201547c"                "V201547d"               
[43] "V201547e"                "V201547z"               
[45] "V201549x"                "RaceEth"                
[47] "V201600"                 "Gender"                 
[49] "V201607"                 "V201610"                
[51] "V201611"                 "V201613"                
[53] "V201615"                 "V201616"                
[55] "V201617x"                "Income"                 
[57] "Income7"                 "V202051"                
[59] "V202066"                 "V202072"                
[61] "VotedPres2020"           "V202073"                
[63] "V202109x"                "V202110x"               
[65] "VotedPres2020_selection"</code></pre>
</div>
</div>
</section>
<section id="national-health-and-nutrition-examination-survey-nhanes" class="slide level2 smaller">
<h2>National Health and Nutrition Examination Survey (NHANES)</h2>
<ul>
<li>Analysis weight: WTINT2YR</li>
<li>Variance Stratum: SDMVSTRA</li>
<li>Variance Primary Sampling Unit: VPSU</li>
<li>Large population</li>
</ul>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Fill in the blank</a></li><li><a href="#tabset-1-2">Solution</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>nhanes_des <span class="ot">&lt;-</span> nhanes <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a></a>   <span class="fu">as_survey_design</span>(</span>
<span id="cb10-3"><a></a>      <span class="at">weights =</span> ___________,</span>
<span id="cb10-4"><a></a>      <span class="at">ids =</span> ___________, </span>
<span id="cb10-5"><a></a>      <span class="at">strata =</span> ___________, </span>
<span id="cb10-6"><a></a>      <span class="at">fpc =</span> ___________, </span>
<span id="cb10-7"><a></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2">
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>nhanes_des <span class="ot">&lt;-</span> nhanes <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a></a>   <span class="fu">as_survey_design</span>(</span>
<span id="cb11-3"><a></a>      <span class="at">weights =</span> WTINT2YR,</span>
<span id="cb11-4"><a></a>      <span class="at">ids =</span> VPSU,</span>
<span id="cb11-5"><a></a>      <span class="at">strata =</span> SDMVSTRA,</span>
<span id="cb11-6"><a></a>      <span class="at">fpc =</span> <span class="cn">NULL</span></span>
<span id="cb11-7"><a></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section></section>
<section>
<section id="replicate-weight-methods" class="title-slide slide level1 center" data-background-color="#087e8b">
<h1>Replicate weight methods</h1>

</section>
<section id="replicate-weights-overview" class="slide level2 smaller">
<h2>Replicate weights overview</h2>
<p>Replicate weights are another method to estimate variability. In general, they are constructed by:</p>
<ol type="1">
<li>Divide the sample into subsample replicates that mirror the design of the sample</li>
<li>Calculate weights for each replicate using the same procedures for the full-sample weight (i.e., nonresponse and post-stratification)</li>
<li>Calculate estimates for each replicate using the same method as the full-sample estimate</li>
<li>Calculate the estimated variance, which is proportional to the variance of the replicate estimates</li>
</ol>
</section>
<section id="common-replicate-weight-methods" class="slide level2">
<h2>Common replicate weight methods</h2>
<ul>
<li>Balanced repeated replication (BRR)</li>
<li>Fay’s BRR</li>
<li>Jackknife</li>
<li>Bootstrap</li>
</ul>
</section></section>
<section>
<section id="specifying-sampling-designs-in-srvyr-with-replicate-weights" class="title-slide slide level1 center" data-background-color="#087e8b">
<h1>Specifying sampling designs in {srvyr} <strong>with</strong> replicate weights</h1>

</section>
<section id="as_survey_rep-syntax" class="slide level2">
<h2><code>as_survey_rep()</code>: Syntax</h2>
<ul>
<li><code>as_survey_rep()</code> creates a <code>tbl_svy</code> object that then correctly calculates weighted estimates and SEs</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">as_survey_rep</span>(</span>
<span id="cb12-2"><a></a>  .data,</span>
<span id="cb12-3"><a></a>  <span class="at">variables =</span> <span class="cn">NULL</span>, <span class="co"># defaults to all in .data</span></span>
<span id="cb12-4"><a></a>  <span class="at">repweights =</span> <span class="cn">NULL</span>, <span class="co"># Variables specifying the replication weights</span></span>
<span id="cb12-5"><a></a>  <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="co"># Variable specifying the analytic/main weight</span></span>
<span id="cb12-6"><a></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"BRR"</span>, <span class="st">"Fay"</span>, <span class="st">"JK1"</span>, <span class="st">"JKn"</span>, <span class="st">"bootstrap"</span>,</span>
<span id="cb12-7"><a></a>    <span class="st">"successive-difference"</span>, <span class="st">"ACS"</span>, <span class="st">"other"</span>), <span class="co"># Type of replication weight</span></span>
<span id="cb12-8"><a></a>  <span class="at">combined_weights =</span> <span class="cn">TRUE</span>, <span class="co"># TRUE if repweights already include sampling weights, usually TRUE</span></span>
<span id="cb12-9"><a></a>  <span class="at">rho =</span> <span class="cn">NULL</span>, <span class="co"># Shrinkage factor for Fay's method</span></span>
<span id="cb12-10"><a></a>  <span class="at">bootstrap_average =</span> <span class="cn">NULL</span>, <span class="co"># For type="bootstrap", if the bootstrap weights have been averaged, gives the number of iterations averaged over</span></span>
<span id="cb12-11"><a></a>  <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="co"># Scaling constant for variance</span></span>
<span id="cb12-12"><a></a>  <span class="at">rscales =</span> <span class="cn">NULL</span>, <span class="co"># Scaling constants for variance</span></span>
<span id="cb12-13"><a></a>  <span class="at">mse =</span> <span class="fu">getOption</span>(<span class="st">"survey.replicates.mse"</span>), <span class="co"># If TRUE, compute variance based around point estimates rather than mean of replicates</span></span>
<span id="cb12-14"><a></a>  <span class="at">degf =</span> <span class="cn">NULL</span>, <span class="co"># Design degrees of freedom, otherwise calculated based on number of replicate weights</span></span>
<span id="cb12-15"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="syntax-for-common-replicate-methods" class="slide level2 smaller">
<h2>Syntax for common replicate methods</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="1-7|9-16|18-25|27-34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>brr_des <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb13-3"><a></a>    <span class="at">weights =</span> WT,</span>
<span id="cb13-4"><a></a>    <span class="at">repweights =</span> <span class="fu">starts_with</span>(<span class="st">"REPWT"</span>),</span>
<span id="cb13-5"><a></a>    <span class="at">type =</span> <span class="st">"BRR"</span>,</span>
<span id="cb13-6"><a></a>    <span class="at">mse =</span> <span class="cn">TRUE</span></span>
<span id="cb13-7"><a></a>  )</span>
<span id="cb13-8"><a></a></span>
<span id="cb13-9"><a></a>fay_des <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb13-11"><a></a>    <span class="at">weights =</span> WT0,</span>
<span id="cb13-12"><a></a>    <span class="at">repweights =</span> <span class="fu">num_range</span>(<span class="st">"WT"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb13-13"><a></a>    <span class="at">type =</span> <span class="st">"Fay"</span>,</span>
<span id="cb13-14"><a></a>    <span class="at">mse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-15"><a></a>    <span class="at">rho =</span> <span class="fl">0.3</span></span>
<span id="cb13-16"><a></a>  )</span>
<span id="cb13-17"><a></a></span>
<span id="cb13-18"><a></a>jkn_des <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb13-20"><a></a>    <span class="at">weights =</span> WT0,</span>
<span id="cb13-21"><a></a>    <span class="at">repweights =</span> WT1<span class="sc">:</span>WT20,</span>
<span id="cb13-22"><a></a>    <span class="at">type =</span> <span class="st">"JKN"</span>,</span>
<span id="cb13-23"><a></a>    <span class="at">mse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-24"><a></a>    <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="fl">0.1</span>, <span class="dv">20</span>)</span>
<span id="cb13-25"><a></a>  )</span>
<span id="cb13-26"><a></a></span>
<span id="cb13-27"><a></a>bs_des <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb13-28"><a></a>  <span class="fu">as_survey_rep</span>(</span>
<span id="cb13-29"><a></a>    <span class="at">weights =</span> pw,</span>
<span id="cb13-30"><a></a>    <span class="at">repweights =</span> pw1<span class="sc">:</span>pw50,</span>
<span id="cb13-31"><a></a>    <span class="at">type =</span> <span class="st">"bootstrap"</span>,</span>
<span id="cb13-32"><a></a>    <span class="at">scale =</span> <span class="fl">0.02186589</span>,</span>
<span id="cb13-33"><a></a>    <span class="at">mse =</span> <span class="cn">TRUE</span></span>
<span id="cb13-34"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Note: this uses fake data and can’t be run, just syntax examples</li>
</ul>
</section></section>
<section>
<section id="example-1" class="title-slide slide level1 center" data-background-color="#0b3954">
<h1>Example</h1>

</section>
<section id="example-recs-2020" class="slide level2 smaller">
<h2>Example: RECS 2020</h2>
<ul>
<li>Using the microdata file to compute estimates and relative standard errors<sup>1</sup></li>
</ul>
<blockquote>
<p>The following instructions are examples for calculating any RECS estimate using the final weights (NWEIGHT) and the associated RSE using the replicate weights (NWEIGHT1 – NWEIGHT60).</p>
</blockquote>
<ul>
<li>Includes R syntax for {survey} package which gets us what we need for {srvyr}</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>repweights <span class="ot">&lt;-</span> <span class="fu">select</span>(RECS2020, NWEIGHT1<span class="sc">:</span>NWEIGHT60)</span>
<span id="cb14-2"><a></a>RECS <span class="ot">&lt;-</span> <span class="fu">svrepdesign</span>(</span>
<span id="cb14-3"><a></a>  <span class="at">data =</span> RECS2020,</span>
<span id="cb14-4"><a></a>  <span class="at">weight =</span> <span class="sc">~</span>NWEIGHT,</span>
<span id="cb14-5"><a></a>  <span class="at">repweights =</span> repweights,</span>
<span id="cb14-6"><a></a>  <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb14-7"><a></a>  <span class="at">combined.weights =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-8"><a></a>  <span class="at">scale =</span> (<span class="fu">ncol</span>(repweights) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">ncol</span>(repweights),</span>
<span id="cb14-9"><a></a>  <span class="at">mse =</span> <span class="cn">TRUE</span></span>
<span id="cb14-10"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside><ol class="aside-footnotes"><li id="fn2"><p><a href="https://www.eia.gov/consumption/residential/data/2020/pdf/microdata-guide.pdf" class="uri">https://www.eia.gov/consumption/residential/data/2020/pdf/microdata-guide.pdf</a></p></li></ol></aside></section>
<section id="example-recs-2020-syntax" class="slide level2">
<h2>Example: RECS 2020 Syntax</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1"></a>recs_des <span class="ot">&lt;-</span> recs_2020 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-2"><a href="#annotated-cell-13-2"></a>  <span class="fu">as_survey_rep</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-13-3" class="code-annotation-target"><a href="#annotated-cell-13-3"></a>    <span class="at">weight =</span> NWEIGHT,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-13-4" class="code-annotation-target"><a href="#annotated-cell-13-4"></a>    <span class="at">repweights =</span> NWEIGHT1<span class="sc">:</span>NWEIGHT60,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-13-5" class="code-annotation-target"><a href="#annotated-cell-13-5"></a>    <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-13-6" class="code-annotation-target"><a href="#annotated-cell-13-6"></a>    <span class="at">scale =</span> <span class="dv">59</span> <span class="sc">/</span> <span class="dv">60</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-13-7" class="code-annotation-target"><a href="#annotated-cell-13-7"></a>    <span class="at">mse =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8"></a>  ) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="3" data-code-annotation="1">Specify the weight variable</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="4" data-code-annotation="2">Specify the replicate weight variables</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="5" data-code-annotation="3">Specify the replicate type per documentation</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="6" data-code-annotation="4">Specify the scale</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="7" data-code-annotation="5">Specify using MSE for variance estimation</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="example-recs-2020-output" class="slide level2">
<h2>Example: RECS 2020 Output</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy"><code class="sourceCode r"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1"></a><span class="fu">summary</span>(recs_des)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: Called via srvyr
Unstratified cluster jacknife (JK1) with 60 replicates and MSE variances.
Sampling variables:
  - repweights: `NWEIGHT1 + NWEIGHT2 + NWEIGHT3 + NWEIGHT4 + NWEIGHT5 +
    NWEIGHT6 + NWEIGHT7 + NWEIGHT8 + NWEIGHT9 + NWEIGHT10 + NWEIGHT11 +
    NWEIGHT12 + NWEIGHT13 + NWEIGHT14 + NWEIGHT15 + NWEIGHT16 + NWEIGHT17 +
    NWEIGHT18 + NWEIGHT19 + NWEIGHT20 + NWEIGHT21 + NWEIGHT22 + NWEIGHT23 +
    NWEIGHT24 + NWEIGHT25 + NWEIGHT26 + NWEIGHT27 + NWEIGHT28 + NWEIGHT29 +
    NWEIGHT30 + NWEIGHT31 + NWEIGHT32 + NWEIGHT33 + NWEIGHT34 + NWEIGHT35 +
    NWEIGHT36 + NWEIGHT37 + NWEIGHT38 + NWEIGHT39 + NWEIGHT40 + NWEIGHT41 +
    NWEIGHT42 + NWEIGHT43 + NWEIGHT44 + NWEIGHT45 + NWEIGHT46 + NWEIGHT47 +
    NWEIGHT48 + NWEIGHT49 + NWEIGHT50 + NWEIGHT51 + NWEIGHT52 + NWEIGHT53 +
    NWEIGHT54 + NWEIGHT55 + NWEIGHT56 + NWEIGHT57 + NWEIGHT58 + NWEIGHT59 +
    NWEIGHT60` 
  - weights: NWEIGHT 
Data variables: 
  - DOEID (dbl), ClimateRegion_BA (fct), Urbanicity (fct), Region (fct),
    REGIONC (chr), Division (fct), STATE_FIPS (chr), state_postal (fct),
    state_name (fct), HDD65 (dbl), CDD65 (dbl), HDD30YR (dbl), CDD30YR
    (dbl), HousingUnitType (fct), YearMade (ord), TOTSQFT_EN (dbl), TOTHSQFT
    (dbl), TOTCSQFT (dbl), SpaceHeatingUsed (lgl), ACUsed (lgl),
    HeatingBehavior (fct), WinterTempDay (dbl), WinterTempAway (dbl),
    WinterTempNight (dbl), ACBehavior (fct), SummerTempDay (dbl),
    SummerTempAway (dbl), SummerTempNight (dbl), NWEIGHT (dbl), NWEIGHT1
    (dbl), NWEIGHT2 (dbl), NWEIGHT3 (dbl), NWEIGHT4 (dbl), NWEIGHT5 (dbl),
    NWEIGHT6 (dbl), NWEIGHT7 (dbl), NWEIGHT8 (dbl), NWEIGHT9 (dbl),
    NWEIGHT10 (dbl), NWEIGHT11 (dbl), NWEIGHT12 (dbl), NWEIGHT13 (dbl),
    NWEIGHT14 (dbl), NWEIGHT15 (dbl), NWEIGHT16 (dbl), NWEIGHT17 (dbl),
    NWEIGHT18 (dbl), NWEIGHT19 (dbl), NWEIGHT20 (dbl), NWEIGHT21 (dbl),
    NWEIGHT22 (dbl), NWEIGHT23 (dbl), NWEIGHT24 (dbl), NWEIGHT25 (dbl),
    NWEIGHT26 (dbl), NWEIGHT27 (dbl), NWEIGHT28 (dbl), NWEIGHT29 (dbl),
    NWEIGHT30 (dbl), NWEIGHT31 (dbl), NWEIGHT32 (dbl), NWEIGHT33 (dbl),
    NWEIGHT34 (dbl), NWEIGHT35 (dbl), NWEIGHT36 (dbl), NWEIGHT37 (dbl),
    NWEIGHT38 (dbl), NWEIGHT39 (dbl), NWEIGHT40 (dbl), NWEIGHT41 (dbl),
    NWEIGHT42 (dbl), NWEIGHT43 (dbl), NWEIGHT44 (dbl), NWEIGHT45 (dbl),
    NWEIGHT46 (dbl), NWEIGHT47 (dbl), NWEIGHT48 (dbl), NWEIGHT49 (dbl),
    NWEIGHT50 (dbl), NWEIGHT51 (dbl), NWEIGHT52 (dbl), NWEIGHT53 (dbl),
    NWEIGHT54 (dbl), NWEIGHT55 (dbl), NWEIGHT56 (dbl), NWEIGHT57 (dbl),
    NWEIGHT58 (dbl), NWEIGHT59 (dbl), NWEIGHT60 (dbl), BTUEL (dbl), DOLLAREL
    (dbl), BTUNG (dbl), DOLLARNG (dbl), BTULP (dbl), DOLLARLP (dbl), BTUFO
    (dbl), DOLLARFO (dbl), BTUWOOD (dbl), TOTALBTU (dbl), TOTALDOL (dbl)
Variables: 
  [1] "DOEID"            "ClimateRegion_BA" "Urbanicity"      
  [4] "Region"           "REGIONC"          "Division"        
  [7] "STATE_FIPS"       "state_postal"     "state_name"      
 [10] "HDD65"            "CDD65"            "HDD30YR"         
 [13] "CDD30YR"          "HousingUnitType"  "YearMade"        
 [16] "TOTSQFT_EN"       "TOTHSQFT"         "TOTCSQFT"        
 [19] "SpaceHeatingUsed" "ACUsed"           "HeatingBehavior" 
 [22] "WinterTempDay"    "WinterTempAway"   "WinterTempNight" 
 [25] "ACBehavior"       "SummerTempDay"    "SummerTempAway"  
 [28] "SummerTempNight"  "NWEIGHT"          "NWEIGHT1"        
 [31] "NWEIGHT2"         "NWEIGHT3"         "NWEIGHT4"        
 [34] "NWEIGHT5"         "NWEIGHT6"         "NWEIGHT7"        
 [37] "NWEIGHT8"         "NWEIGHT9"         "NWEIGHT10"       
 [40] "NWEIGHT11"        "NWEIGHT12"        "NWEIGHT13"       
 [43] "NWEIGHT14"        "NWEIGHT15"        "NWEIGHT16"       
 [46] "NWEIGHT17"        "NWEIGHT18"        "NWEIGHT19"       
 [49] "NWEIGHT20"        "NWEIGHT21"        "NWEIGHT22"       
 [52] "NWEIGHT23"        "NWEIGHT24"        "NWEIGHT25"       
 [55] "NWEIGHT26"        "NWEIGHT27"        "NWEIGHT28"       
 [58] "NWEIGHT29"        "NWEIGHT30"        "NWEIGHT31"       
 [61] "NWEIGHT32"        "NWEIGHT33"        "NWEIGHT34"       
 [64] "NWEIGHT35"        "NWEIGHT36"        "NWEIGHT37"       
 [67] "NWEIGHT38"        "NWEIGHT39"        "NWEIGHT40"       
 [70] "NWEIGHT41"        "NWEIGHT42"        "NWEIGHT43"       
 [73] "NWEIGHT44"        "NWEIGHT45"        "NWEIGHT46"       
 [76] "NWEIGHT47"        "NWEIGHT48"        "NWEIGHT49"       
 [79] "NWEIGHT50"        "NWEIGHT51"        "NWEIGHT52"       
 [82] "NWEIGHT53"        "NWEIGHT54"        "NWEIGHT55"       
 [85] "NWEIGHT56"        "NWEIGHT57"        "NWEIGHT58"       
 [88] "NWEIGHT59"        "NWEIGHT60"        "BTUEL"           
 [91] "DOLLAREL"         "BTUNG"            "DOLLARNG"        
 [94] "BTULP"            "DOLLARLP"         "BTUFO"           
 [97] "DOLLARFO"         "BTUWOOD"          "TOTALBTU"        
[100] "TOTALDOL"        </code></pre>
</div>
</div>
</section>
<section id="american-community-survey-acs" class="slide level2">
<h2>American Community Survey (ACS)</h2>
<ul>
<li>Analysis weight: PWGTP</li>
<li>replicate weights: PWGTP1-PWGTP180</li>
<li>jackknife with scale adjustment of 4/80</li>
</ul>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Fill in the blank</a></li><li><a href="#tabset-2-2">Solution</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>acs_des <span class="ot">&lt;-</span> acs_pums <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a></a>   <span class="fu">as_survey_rep</span>(</span>
<span id="cb16-3"><a></a>      <span class="at">weights =</span> ___________,</span>
<span id="cb16-4"><a></a>      <span class="at">repweights =</span> ___________,</span>
<span id="cb16-5"><a></a>      <span class="at">type =</span> ___________,</span>
<span id="cb16-6"><a></a>      <span class="at">scale =</span> _________ </span>
<span id="cb16-7"><a></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2">
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>acs_des <span class="ot">&lt;-</span> acs_pums <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a></a>   <span class="fu">as_survey_rep</span>(</span>
<span id="cb17-3"><a></a>      <span class="at">weights =</span> PWGTP,</span>
<span id="cb17-4"><a></a>      <span class="at">repweights =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">"PWGTP"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">80</span>),</span>
<span id="cb17-5"><a></a>      <span class="at">type =</span> <span class="st">"JK1"</span>,</span>
<span id="cb17-6"><a></a>      <span class="at">scale =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">80</span></span>
<span id="cb17-7"><a></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section></section>
<section id="your-turn" class="title-slide slide level1 center" data-background-color="#ff8484">
<h1>Your turn</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_947961f6" data-warn-when="300" data-update-every="1" data-play-sound="true" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>

<section id="open-q-a" class="title-slide slide level1 center" data-background-color="#087e8b">
<h1>Open Q &amp; A</h1>


</section>


    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/favicon.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/tidy-survey-r\.github\.io\/user-2025-survey-data-tutorial\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>