{
  "hash": "227ef81e9997a2c09421c047d1228cc3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Getting Started\"\nformat: revealjs\nslide-number: true\ntitle-slide-attributes: \n  data-background: \"#087e8b\"\n---\n\n\n\n# Warm Up {background-color='{{< brand color secondary >}}'}\n\n## Posit Cloud\n<!--TODO: Update this with Posit Cloud info-->\n<!--TODO: Work individually?-->\n\n- We will be using Posit Cloud for exercises\n  - Posit Cloud has the same features and appearance as RStudio for ease of use\n- Access the project and files via our link\n- Navigate to \"Complex Survey Analysis in R\" under Projects then click name to get started\n- We will go through slides of content then work on exercises independently, then regroup to go over answers\n\n## Welcome to the Towny Data\n\n- We'll be using the `towny` data for warm-up exercises\n- Available in the {gt} package\n\n![](../images/towny.png){fig-align=\"center\"}\n\n## Posit Cloud Demonstration\n\n- Load {tidyverse} and {gt}\n- Look at the towny dataset using `glimpse()`\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gt)\nglimpse(towny)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 414\nColumns: 25\n$ name                     <chr> \"Addington Highlands\", \"Adelaide Metcalfe\"…\n$ website                  <chr> \"https://addingtonhighlands.ca\", \"https://…\n$ status                   <chr> \"lower-tier\", \"lower-tier\", \"lower-tier\", …\n$ csd_type                 <chr> \"township\", \"township\", \"township\", \"towns…\n$ census_div               <chr> \"Lennox and Addington\", \"Middlesex\", \"Simc…\n$ latitude                 <dbl> 45.00000, 42.95000, 44.13333, 45.52917, 43…\n$ longitude                <dbl> -77.25000, -81.70000, -79.93333, -76.89694…\n$ land_area_km2            <dbl> 1293.99, 331.11, 371.53, 519.59, 66.64, 11…\n$ population_1996          <int> 2429, 3128, 9359, 2837, 64430, 1027, 8315,…\n$ population_2001          <int> 2402, 3149, 10082, 2824, 73753, 956, 8593,…\n$ population_2006          <int> 2512, 3135, 10695, 2716, 90167, 958, 8654,…\n$ population_2011          <int> 2517, 3028, 10603, 2844, 109600, 864, 9196…\n$ population_2016          <int> 2318, 2990, 10975, 2935, 119677, 969, 9680…\n$ population_2021          <int> 2534, 3011, 10989, 2995, 126666, 954, 9949…\n$ density_1996             <dbl> 1.88, 9.45, 25.19, 5.46, 966.84, 8.81, 21.…\n$ density_2001             <dbl> 1.86, 9.51, 27.14, 5.44, 1106.74, 8.20, 21…\n$ density_2006             <dbl> 1.94, 9.47, 28.79, 5.23, 1353.05, 8.22, 22…\n$ density_2011             <dbl> 1.95, 9.14, 28.54, 5.47, 1644.66, 7.41, 23…\n$ density_2016             <dbl> 1.79, 9.03, 29.54, 5.65, 1795.87, 8.31, 24…\n$ density_2021             <dbl> 1.96, 9.09, 29.58, 5.76, 1900.75, 8.18, 25…\n$ pop_change_1996_2001_pct <dbl> -0.0111, 0.0067, 0.0773, -0.0046, 0.1447, …\n$ pop_change_2001_2006_pct <dbl> 0.0458, -0.0044, 0.0608, -0.0382, 0.2226, …\n$ pop_change_2006_2011_pct <dbl> 0.0020, -0.0341, -0.0086, 0.0471, 0.2155, …\n$ pop_change_2011_2016_pct <dbl> -0.0791, -0.0125, 0.0351, 0.0320, 0.0919, …\n$ pop_change_2016_2021_pct <dbl> 0.0932, 0.0070, 0.0013, 0.0204, 0.0584, -0…\n```\n\n\n:::\n:::\n\n\n\n## Your Turn {background-color='{{< brand color pink >}}'}\n\n\n\n::: {.cell}\n\n:::\n\n\n\n- Open `02-getting-started_exercises.qmd`\n- Take 10 minutes to set up Posit Cloud and finish the exercises individually.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_aceec36d\" data-warn-when=\"180\" data-update-every=\"1\" data-play-sound=\"true\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n# Packages {background-color='{{< brand color secondary >}}'}\n\n## R Packages for Survey Analysis\n\n- {survey} package first on CRAN in 2003\n  - descriptive analysis\n  - statistical testing\n  - modeling\n  - weighting\n\n- {srvyr} package first on CRAN in 2016\n  - “wrapper” for {survey} with {tidyverse}-style syntax\n  - only descriptive analysis\n\n## Install Packages\n\nInstall packages for data wrangling and survey analysis:\n\n```r\ninstall.packages(c(\"tidyverse\", \"survey\", \"srvyr\"))\n```\n\n. . .\n\nInstall {srvyrexploR} to access the survey data for today's workshop:\n\n```r\ninstall.packages(\"pak\")\npak::pak(\"tidy-survey-r/srvyrexploR\")\n```\n\n. . .\n\nLoad the packages:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(survey)\nlibrary(srvyr)\nlibrary(srvyrexploR)\n```\n:::\n\n\n\n::: aside\nNote: Installation of packages is already done for you on Posit Cloud\n:::\n\n# Data {background-color='{{< brand color secondary >}}'}\n\n## Today's Data\n\n**American National Election Studies (ANES – DeBell 2010)**\n\n  * Stored as `anes_2020` in {srvyrexploR}\n  \n**Residential Energy Consumption Survey (RECS – U.S. Energy Information Administration 2023b)**\n\n* Stored as `recs_2020` in {srvyrexploR}\n\n## American National Election Studies (ANES) 2020 {.smaller}\n\n::: incremental\n\n- Pre- and post-election surveys fielded almost every 2 years since 1948\n- Topics include voter registration status, candidate preference, opinions on country and government, party and ideology affiliation, opinions on policy, news sources, and more\n- Collaboration of Stanford, University of Michigan - funding by the National Science Foundation\n- <b>Target Population</b>: US citizens, 18 and older living in US \n- <b>Mode</b>: Web, videoconference, or telephone\n- <b>Sample Information</b>: Pseudo-strata and pseudo-cluster included for variance estimation\n\nhttps://electionstudies.org/\n\n:::\n\n## American National Election Studies (ANES) 2020\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2|\"}\nanes_2020 %>%\n  select(-matches(\"^V\\\\d\")) %>%\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 7,453\nColumns: 21\n$ CaseID                  <dbl> 200015, 200022, 200039, 200046, 200053, 200…\n$ InterviewMode           <fct> Web, Web, Web, Web, Web, Web, Web, Web, Web…\n$ Weight                  <dbl> 1.0057375, 1.1634731, 0.7686811, 0.5210195,…\n$ VarUnit                 <fct> 2, 2, 1, 2, 1, 2, 1, 2, 2, 2, 1, 1, 2, 2, 2…\n$ Stratum                 <fct> 9, 26, 41, 29, 23, 37, 7, 37, 32, 41, 22, 7…\n$ CampaignInterest        <fct> Somewhat interested, Not much interested, S…\n$ EarlyVote2020           <fct> NA, NA, NA, NA, NA, NA, NA, NA, Yes, NA, NA…\n$ VotedPres2016           <fct> Yes, Yes, Yes, Yes, Yes, No, Yes, No, Yes, …\n$ VotedPres2016_selection <fct> Trump, Other, Clinton, Clinton, Trump, NA, …\n$ PartyID                 <fct> Strong republican, Independent, Independent…\n$ TrustGovernment         <fct> Never, Never, Some of the time, About half …\n$ TrustPeople             <fct> About half the time, Some of the time, Some…\n$ Age                     <dbl> 46, 37, 40, 41, 72, 71, 37, 45, 70, 43, 37,…\n$ AgeGroup                <fct> 40-49, 30-39, 40-49, 40-49, 70 or older, 70…\n$ Education               <fct> Bachelor's, Post HS, High school, Post HS, …\n$ RaceEth                 <fct> \"Hispanic\", \"Asian, NH/PI\", \"White\", \"Asian…\n$ Gender                  <fct> Male, Female, Female, Male, Male, Female, F…\n$ Income                  <fct> \"$175,000-249,999\", \"$70,000-74,999\", \"$100…\n$ Income7                 <fct> $125k or more, $60k to < 80k, $100k to < 12…\n$ VotedPres2020           <fct> NA, Yes, Yes, Yes, Yes, Yes, Yes, NA, Yes, …\n$ VotedPres2020_selection <fct> NA, Other, Biden, Biden, Trump, Biden, Trum…\n```\n\n\n:::\n:::\n\n\n\n## Residential Energy Consumption Survey (RECS) 2015 {.smaller}\n\n::: incremental\n\n- Energy consumption/expenditures collected through energy suppliers\n- Fielded 14 times between 1950 and 2015\n- Topics include appliances, electronics, heating, a/c, temperatures, water heating, lighting, energy bills, respondent demographics, and energy assistance\n- Funded by the Energy Information Administration\n- <b>Target Population</b>: Primary occupied housing units in the US\n- <b>Mode</b>: In-person, paper, and web interview mode\n- <b>Sample Information</b>: BRR Replicate weights included for variance estimation\n\nhttps://www.eia.gov/consumption/residential/index.php\n\n:::\n\n## Residential Energy Consumption Survey (RECS) 2015\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2|\"}\nrecs_2020 %>%\n  select(-matches(\"^NWEIGHT\")) %>%\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 18,496\nColumns: 39\n$ DOEID            <dbl> 100001, 100002, 100003, 100004, 100005, 100006, 10…\n$ ClimateRegion_BA <fct> Mixed-Dry, Mixed-Humid, Mixed-Dry, Mixed-Humid, Mi…\n$ Urbanicity       <fct> Urban Area, Urban Area, Urban Area, Urban Area, Ur…\n$ Region           <fct> West, South, West, South, Northeast, South, South,…\n$ REGIONC          <chr> \"WEST\", \"SOUTH\", \"WEST\", \"SOUTH\", \"NORTHEAST\", \"SO…\n$ Division         <fct> Mountain South, West South Central, Mountain South…\n$ STATE_FIPS       <chr> \"35\", \"05\", \"35\", \"45\", \"34\", \"48\", \"40\", \"28\", \"1…\n$ state_postal     <fct> NM, AR, NM, SC, NJ, TX, OK, MS, DC, AZ, CA, TX, LA…\n$ state_name       <fct> New Mexico, Arkansas, New Mexico, South Carolina, …\n$ HDD65            <dbl> 3844, 3766, 3819, 2614, 4219, 901, 3148, 1825, 423…\n$ CDD65            <dbl> 1679, 1458, 1696, 1718, 1363, 3558, 2128, 2374, 11…\n$ HDD30YR          <dbl> 4451, 4429, 4500, 3229, 4896, 1150, 3564, 2660, 44…\n$ CDD30YR          <dbl> 1027, 1305, 1010, 1653, 1059, 3588, 2043, 2164, 14…\n$ HousingUnitType  <fct> Single-family detached, Apartment: 5 or more units…\n$ YearMade         <ord> 1970-1979, 1980-1989, 1960-1969, 1980-1989, 1960-1…\n$ TOTSQFT_EN       <dbl> 2100, 590, 900, 2100, 800, 4520, 2100, 900, 750, 7…\n$ TOTHSQFT         <dbl> 2100, 590, 900, 2100, 800, 3010, 1200, 900, 750, 7…\n$ TOTCSQFT         <dbl> 2100, 590, 900, 2100, 800, 3010, 1200, 0, 500, 760…\n$ SpaceHeatingUsed <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…\n$ ACUsed           <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, T…\n$ HeatingBehavior  <fct> Set one temp and leave it, Turn on or off as neede…\n$ WinterTempDay    <dbl> 70, 70, 69, 68, 68, 76, 74, 70, 68, 70, 72, 74, 74…\n$ WinterTempAway   <dbl> 70, 65, 68, 68, 68, 76, 65, 70, 60, 70, 70, 74, 74…\n$ WinterTempNight  <dbl> 68, 65, 67, 68, 68, 68, 74, 68, 62, 68, 72, 74, 74…\n$ ACBehavior       <fct> Set one temp and leave it, Turn on or off as neede…\n$ SummerTempDay    <dbl> 71, 68, 70, 72, 72, 69, 68, NA, 72, 74, 77, 77, 74…\n$ SummerTempAway   <dbl> 71, 68, 68, 72, 72, 74, 70, NA, 76, 74, 77, 77, 74…\n$ SummerTempNight  <dbl> 71, 68, 68, 72, 72, 68, 70, NA, 68, 72, 77, 77, 74…\n$ BTUEL            <dbl> 42723.28, 17889.29, 8146.63, 31646.53, 20027.42, 4…\n$ DOLLAREL         <dbl> 1955.06, 713.27, 334.51, 1424.86, 1087.00, 1895.66…\n$ BTUNG            <dbl> 101924.43, 10145.32, 22603.08, 55118.66, 39099.51,…\n$ DOLLARNG         <dbl> 701.8300, 261.7348, 188.1400, 636.9100, 376.0400, …\n$ BTULP            <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.…\n$ DOLLARLP         <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.…\n$ BTUFO            <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.…\n$ DOLLARFO         <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.…\n$ BTUWOOD          <dbl> 0, 0, 0, 0, 0, 3000, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ TOTALBTU         <dbl> 144647.71, 28034.61, 30749.71, 86765.19, 59126.93,…\n$ TOTALDOL         <dbl> 2656.8900, 975.0048, 522.6500, 2061.7700, 1463.040…\n```\n\n\n:::\n:::\n\n\n\n# Design Objects {background-color='{{< brand color secondary >}}'}\n\n## Design Objects\n\n**We will be covering survey design in more detail later in the workshop!**\n\n::: incremental\n\n- Backbone for survey analysis\n- Specify the sampling design, weights, and other necessary information to account for errors in the data\n- Survey analysis and inference should be performed with the survey design objects, not the original survey data\n\n:::\n\n## American National Election Studies Design Object\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|1|2|3,8|4-7\"}\nanes_des <- anes_2020 %>%\n  mutate(Weight = V200010b / sum(V200010b) * 231034125) %>%\n  as_survey_design(\n    weights = Weight,\n    strata = V200010d,\n    ids = V200010c,\n    nest = TRUE\n  )\n```\n:::\n\n\n\n## American National Election Studies Design Object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanes_des\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStratified 1 - level Cluster Sampling design (with replacement)\nWith (101) clusters.\nCalled via srvyr\nSampling variables:\n  - ids: V200010c \n  - strata: V200010d \n  - weights: Weight \nData variables: \n  - V200001 (dbl), CaseID (dbl), V200002 (hvn_lbll), InterviewMode (fct),\n    V200010b (dbl), Weight (dbl), V200010c (dbl), VarUnit (fct), V200010d\n    (dbl), Stratum (fct), V201006 (hvn_lbll), CampaignInterest (fct),\n    V201023 (hvn_lbll), EarlyVote2020 (fct), V201024 (hvn_lbll), V201025x\n    (hvn_lbll), V201028 (hvn_lbll), V201029 (hvn_lbll), V201101 (hvn_lbll),\n    V201102 (hvn_lbll), VotedPres2016 (fct), V201103 (hvn_lbll),\n    VotedPres2016_selection (fct), V201228 (hvn_lbll), V201229 (hvn_lbll),\n    V201230 (hvn_lbll), V201231x (hvn_lbll), PartyID (fct), V201233\n    (hvn_lbll), TrustGovernment (fct), V201237 (hvn_lbll), TrustPeople\n    (fct), V201507x (hvn_lbll), Age (dbl), AgeGroup (fct), V201510\n    (hvn_lbll), Education (fct), V201546 (hvn_lbll), V201547a (hvn_lbll),\n    V201547b (hvn_lbll), V201547c (hvn_lbll), V201547d (hvn_lbll), V201547e\n    (hvn_lbll), V201547z (hvn_lbll), V201549x (hvn_lbll), RaceEth (fct),\n    V201600 (hvn_lbll), Gender (fct), V201607 (hvn_lbll), V201610\n    (hvn_lbll), V201611 (hvn_lbll), V201613 (hvn_lbll), V201615 (hvn_lbll),\n    V201616 (hvn_lbll), V201617x (hvn_lbll), Income (fct), Income7 (fct),\n    V202051 (hvn_lbll), V202066 (hvn_lbll), V202072 (hvn_lbll),\n    VotedPres2020 (fct), V202073 (hvn_lbll), V202109x (hvn_lbll), V202110x\n    (hvn_lbll), VotedPres2020_selection (fct)\n```\n\n\n:::\n:::\n\n\n\n## Residential Energy Consumption Survey Design Object\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|1|2,8|3-7\"}\nrecs_des <- recs_2020 %>%\n  as_survey_rep(\n    weights = NWEIGHT,\n    repweights = NWEIGHT1:NWEIGHT60,\n    type = \"JK1\",\n    scale = 59 / 60,\n    mse = TRUE\n  )\n```\n:::\n\n\n\n## Residential Energy Consumption Survey Design Object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrecs_des\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: Called via srvyr\nUnstratified cluster jacknife (JK1) with 60 replicates and MSE variances.\nSampling variables:\n  - repweights: `NWEIGHT1 + NWEIGHT2 + NWEIGHT3 + NWEIGHT4 + NWEIGHT5 +\n    NWEIGHT6 + NWEIGHT7 + NWEIGHT8 + NWEIGHT9 + NWEIGHT10 + NWEIGHT11 +\n    NWEIGHT12 + NWEIGHT13 + NWEIGHT14 + NWEIGHT15 + NWEIGHT16 + NWEIGHT17 +\n    NWEIGHT18 + NWEIGHT19 + NWEIGHT20 + NWEIGHT21 + NWEIGHT22 + NWEIGHT23 +\n    NWEIGHT24 + NWEIGHT25 + NWEIGHT26 + NWEIGHT27 + NWEIGHT28 + NWEIGHT29 +\n    NWEIGHT30 + NWEIGHT31 + NWEIGHT32 + NWEIGHT33 + NWEIGHT34 + NWEIGHT35 +\n    NWEIGHT36 + NWEIGHT37 + NWEIGHT38 + NWEIGHT39 + NWEIGHT40 + NWEIGHT41 +\n    NWEIGHT42 + NWEIGHT43 + NWEIGHT44 + NWEIGHT45 + NWEIGHT46 + NWEIGHT47 +\n    NWEIGHT48 + NWEIGHT49 + NWEIGHT50 + NWEIGHT51 + NWEIGHT52 + NWEIGHT53 +\n    NWEIGHT54 + NWEIGHT55 + NWEIGHT56 + NWEIGHT57 + NWEIGHT58 + NWEIGHT59 +\n    NWEIGHT60` \n  - weights: NWEIGHT \nData variables: \n  - DOEID (dbl), ClimateRegion_BA (fct), Urbanicity (fct), Region (fct),\n    REGIONC (chr), Division (fct), STATE_FIPS (chr), state_postal (fct),\n    state_name (fct), HDD65 (dbl), CDD65 (dbl), HDD30YR (dbl), CDD30YR\n    (dbl), HousingUnitType (fct), YearMade (ord), TOTSQFT_EN (dbl), TOTHSQFT\n    (dbl), TOTCSQFT (dbl), SpaceHeatingUsed (lgl), ACUsed (lgl),\n    HeatingBehavior (fct), WinterTempDay (dbl), WinterTempAway (dbl),\n    WinterTempNight (dbl), ACBehavior (fct), SummerTempDay (dbl),\n    SummerTempAway (dbl), SummerTempNight (dbl), NWEIGHT (dbl), NWEIGHT1\n    (dbl), NWEIGHT2 (dbl), NWEIGHT3 (dbl), NWEIGHT4 (dbl), NWEIGHT5 (dbl),\n    NWEIGHT6 (dbl), NWEIGHT7 (dbl), NWEIGHT8 (dbl), NWEIGHT9 (dbl),\n    NWEIGHT10 (dbl), NWEIGHT11 (dbl), NWEIGHT12 (dbl), NWEIGHT13 (dbl),\n    NWEIGHT14 (dbl), NWEIGHT15 (dbl), NWEIGHT16 (dbl), NWEIGHT17 (dbl),\n    NWEIGHT18 (dbl), NWEIGHT19 (dbl), NWEIGHT20 (dbl), NWEIGHT21 (dbl),\n    NWEIGHT22 (dbl), NWEIGHT23 (dbl), NWEIGHT24 (dbl), NWEIGHT25 (dbl),\n    NWEIGHT26 (dbl), NWEIGHT27 (dbl), NWEIGHT28 (dbl), NWEIGHT29 (dbl),\n    NWEIGHT30 (dbl), NWEIGHT31 (dbl), NWEIGHT32 (dbl), NWEIGHT33 (dbl),\n    NWEIGHT34 (dbl), NWEIGHT35 (dbl), NWEIGHT36 (dbl), NWEIGHT37 (dbl),\n    NWEIGHT38 (dbl), NWEIGHT39 (dbl), NWEIGHT40 (dbl), NWEIGHT41 (dbl),\n    NWEIGHT42 (dbl), NWEIGHT43 (dbl), NWEIGHT44 (dbl), NWEIGHT45 (dbl),\n    NWEIGHT46 (dbl), NWEIGHT47 (dbl), NWEIGHT48 (dbl), NWEIGHT49 (dbl),\n    NWEIGHT50 (dbl), NWEIGHT51 (dbl), NWEIGHT52 (dbl), NWEIGHT53 (dbl),\n    NWEIGHT54 (dbl), NWEIGHT55 (dbl), NWEIGHT56 (dbl), NWEIGHT57 (dbl),\n    NWEIGHT58 (dbl), NWEIGHT59 (dbl), NWEIGHT60 (dbl), BTUEL (dbl), DOLLAREL\n    (dbl), BTUNG (dbl), DOLLARNG (dbl), BTULP (dbl), DOLLARLP (dbl), BTUFO\n    (dbl), DOLLARFO (dbl), BTUWOOD (dbl), TOTALBTU (dbl), TOTALDOL (dbl)\n```\n\n\n:::\n:::\n\n\n\n# Similarities (and Differences) Between {dplyr} and {srvyr} Functions {background-color='{{< brand color secondary >}}'}\n\n## Why use {srvyr} over {survey}?\n\nThe {srvyr} package builds on the {survey} package by providing wrappers for functions that align with the tidyverse philosophy.\n\n::: incremental\n\n* Use the pipe function `%>%` or `|>`\n* Ability to use tidy selection\n* Functions follow `snake_case` convention\n\n:::\n\n## Apply {dplyr} functions to survey objects\n\n- A few functions in {srvyr} have counterparts in {dplyr}\n  - `dplyr::summarize()` and `srvyr::summarize()`\n  - `dplyr::group_by()` and `srvyr::group_by()`\n- Based on the object class, R will recognize which package to use\n\n## Tibbles vs. survey table object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(towny)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n:::\n\n\nvs.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(recs_des)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"tbl_svy\"       \"svyrep.design\"\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(anes_des)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"tbl_svy\"        \"survey.design2\" \"survey.design\" \n```\n\n\n:::\n:::\n\n\n\n## Using `summarize()` to calculate mean and median\n\n### Tibble:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|1,4|2,3|\"}\ntowny %>%\n  summarize(\n    area_mean = mean(land_area_km2)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  area_mean\n      <dbl>\n1      373.\n```\n\n\n:::\n:::\n\n\n\n## Using `summarize()` to calculate mean and median\n\n### Survey object:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|1,4|2,3|\"}\nrecs_des %>%\n  summarize(\n    TOTHSQFT_mean = survey_mean(TOTHSQFT),\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  TOTHSQFT_mean TOTHSQFT_mean_se\n          <dbl>            <dbl>\n1         1614.             7.19\n```\n\n\n:::\n:::\n\n\n\n## Using tidyselect\n\n### Tibble:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2,5|3|4|\"}\ntowny %>%\n  summarize(across(\n    starts_with(\"population\"),\n    ~ mean(.x, na.rm = TRUE)\n  ))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 6\n  population_1996 population_2001 population_2006 population_2011\n            <dbl>           <dbl>           <dbl>           <dbl>\n1          25866.          27538.          29173.          30838.\n# ℹ 2 more variables: population_2016 <dbl>, population_2021 <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Using tidyselect\n\n### Survey object:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2,5|3|4|\"}\nrecs_des %>%\n  summarize(across(\n    starts_with(\"TOT\"),\n    ~ survey_mean(.x, na.rm = TRUE)\n  ))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 10\n  TOTSQFT_EN TOTSQFT_EN_se TOTHSQFT TOTHSQFT_se TOTCSQFT TOTCSQFT_se TOTALBTU\n       <dbl>         <dbl>    <dbl>       <dbl>    <dbl>       <dbl>    <dbl>\n1      1819.          6.62    1614.        7.19    1335.        6.72   76753.\n# ℹ 3 more variables: TOTALBTU_se <dbl>, TOTALDOL <dbl>, TOTALDOL_se <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Using {dplyr} functions\n\n### Tibble:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2|3|\"}\ntowny %>%\n  filter(csd_type == \"township\") %>%\n  select(csd_type, name)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 195 × 2\n   csd_type name                  \n   <chr>    <chr>                 \n 1 township Addington Highlands   \n 2 township Adelaide Metcalfe     \n 3 township Adjala-Tosorontio     \n 4 township Admaston/Bromley      \n 5 township Alberton              \n 6 township Alfred and Plantagenet\n 7 township Algonquin Highlands   \n 8 township Alnwick/Haldimand     \n 9 township Amaranth              \n10 township The Archipelago       \n# ℹ 185 more rows\n```\n\n\n:::\n:::\n\n\n\n## Using {dplyr} functions\n\n### Survey object:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|1|2|3|\"}\nrecs_des_mod <- recs_des %>%\n  filter(Urbanicity == \"Rural\") %>%\n  select(ACUsed)\n\nrecs_des_mod\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: Called via srvyr\nUnstratified cluster jacknife (JK1) with 60 replicates and MSE variances.\nSampling variables:\n  - repweights: `NWEIGHT1 + NWEIGHT2 + NWEIGHT3 + NWEIGHT4 + NWEIGHT5 +\n    NWEIGHT6 + NWEIGHT7 + NWEIGHT8 + NWEIGHT9 + NWEIGHT10 + NWEIGHT11 +\n    NWEIGHT12 + NWEIGHT13 + NWEIGHT14 + NWEIGHT15 + NWEIGHT16 + NWEIGHT17 +\n    NWEIGHT18 + NWEIGHT19 + NWEIGHT20 + NWEIGHT21 + NWEIGHT22 + NWEIGHT23 +\n    NWEIGHT24 + NWEIGHT25 + NWEIGHT26 + NWEIGHT27 + NWEIGHT28 + NWEIGHT29 +\n    NWEIGHT30 + NWEIGHT31 + NWEIGHT32 + NWEIGHT33 + NWEIGHT34 + NWEIGHT35 +\n    NWEIGHT36 + NWEIGHT37 + NWEIGHT38 + NWEIGHT39 + NWEIGHT40 + NWEIGHT41 +\n    NWEIGHT42 + NWEIGHT43 + NWEIGHT44 + NWEIGHT45 + NWEIGHT46 + NWEIGHT47 +\n    NWEIGHT48 + NWEIGHT49 + NWEIGHT50 + NWEIGHT51 + NWEIGHT52 + NWEIGHT53 +\n    NWEIGHT54 + NWEIGHT55 + NWEIGHT56 + NWEIGHT57 + NWEIGHT58 + NWEIGHT59 +\n    NWEIGHT60` \n  - weights: NWEIGHT \nData variables: \n  - ACUsed (lgl)\n```\n\n\n:::\n:::\n\n\n\n## Grouping\n\n### Tibble:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2|3|\"}\ntowny %>%\n  group_by(csd_type) %>%\n  summarize(area_mean = mean(land_area_km2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  csd_type     area_mean\n  <chr>            <dbl>\n1 city             498. \n2 municipality     607. \n3 town             183. \n4 township         363. \n5 village           23.0\n```\n\n\n:::\n:::\n\n\n\n## Grouping\n\n### Survey object:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2|3|\"}\nrecs_des %>%\n  group_by(Urbanicity) %>%\n  summarize(TOTHSQFT_mean = survey_mean(TOTHSQFT))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  Urbanicity    TOTHSQFT_mean TOTHSQFT_mean_se\n  <fct>                 <dbl>            <dbl>\n1 Urban Area            1532.             9.24\n2 Urban Cluster         1537.            21.5 \n3 Rural                 1966.            17.7 \n```\n\n\n:::\n:::\n\n\n\n## Using {srvyr} functions on non-survey objects\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|2\"}\ntowny %>%\n  summarize(area_mean = survey_mean(land_area_km2))\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-error}\n\n```\nError in `summarize()`:\nℹ In argument: `area_mean = survey_mean(land_area_km2)`.\nCaused by error in `cur_svy()`:\n! Survey context not set\n```\n\n\n:::\n:::\n\n\n\n# Survey Analysis Process {background-color='{{< brand color secondary >}}'}\n\n## Overview of Survey Analysis using {srvyr} Package\n\n::: incremental\n\n1. Create a `tbl_svy` object (a survey object) using: `as_survey_design()` or `as_survey_rep()`\n\n2. Subset data (if needed) using `filter()` (to create subpopulations)\n\n3. Specify domains of analysis using `group_by()`\n\n4. Within `summarize()`, specify variables to calculate, including means, totals, proportions, quantiles, and more\n\n:::\n\n# Wrap Up {background-color='{{< brand color secondary >}}'}\n\n## Wrap Up\n\n* We will be using {tidyverse}, {survey}, and {srvyr} for survey analysis\n* Our data is from ANES and RECS\n\n## Wrap Up\n\n* (Survey) design objects are the backbone for survey analysis\n* They are objects with special class `tbl_svy`\n* They specify the sampling design, weights, and other necessary information to account for errors in the data\n\n## Wrap Up\n\n* {srvyr} wraps {survey} so that we can use friendly, \"tidy\" syntax\n* Based on the object type, R will know whether to use {dplyr} or {srvyr}\n* All functions must be done on the survey design object, not the raw data\n\n# Extra Content {background-color='{{< brand color secondary >}}'}\n\n## Ex. 1\n\nHow many different types of CSD are there in the dataset?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  count(csd_type)\n```\n:::\n\n\n\n. . .\n\nor\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  group_by(csd_type) %>%\n  summarize(n = n(), .groups = \"drop\")\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  csd_type         n\n  <chr>        <int>\n1 city            52\n2 municipality    68\n3 town            88\n4 township       195\n5 village         11\n```\n\n\n:::\n:::\n\n\n\n## Ex. 2\n\nHow many different types of CSD and status are there in the dataset?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  count(csd_type, status)\n```\n:::\n\n\n\n. . .\n\nor\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  group_by(csd_type, status) %>%\n  summarize(n = n(), .groups = \"drop\")\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 3\n   csd_type     status          n\n   <chr>        <chr>       <int>\n 1 city         lower-tier     20\n 2 city         single-tier    32\n 3 municipality lower-tier     41\n 4 municipality single-tier    27\n 5 town         lower-tier     61\n 6 town         single-tier    27\n 7 township     lower-tier    113\n 8 township     single-tier    82\n 9 village      lower-tier      6\n10 village      single-tier     5\n```\n\n\n:::\n:::\n\n\n\n## Ex. 3\n\nWhat is the proportion of each type of CSD?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  count(csd_type) %>%\n  mutate(p = n / sum(n))\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 3\n  csd_type         n      p\n  <chr>        <int>  <dbl>\n1 city            52 0.126 \n2 municipality    68 0.164 \n3 town            88 0.213 \n4 township       195 0.471 \n5 village         11 0.0266\n```\n\n\n:::\n:::\n\n\n\n## Ex. 4\n\nWhat is the proportion of each status within type of CSD?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  count(csd_type, status) %>%\n  group_by(csd_type) %>%\n  mutate(p = n / sum(n))\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 4\n# Groups:   csd_type [5]\n   csd_type     status          n     p\n   <chr>        <chr>       <int> <dbl>\n 1 city         lower-tier     20 0.385\n 2 city         single-tier    32 0.615\n 3 municipality lower-tier     41 0.603\n 4 municipality single-tier    27 0.397\n 5 town         lower-tier     61 0.693\n 6 town         single-tier    27 0.307\n 7 township     lower-tier    113 0.579\n 8 township     single-tier    82 0.421\n 9 village      lower-tier      6 0.545\n10 village      single-tier     5 0.455\n```\n\n\n:::\n:::\n\n\n\n## Ex. 5\n\nWhat is the mean population of all of the municipalities in 2021?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  summarize(mean_pop = mean(population_2021, na.rm = TRUE))\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  mean_pop\n     <dbl>\n1   34142.\n```\n\n\n:::\n:::\n\n\n\n## Ex. 6\n\nWhat is the mean population by CSD in 2021?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  group_by(csd_type) %>%\n  summarize(mean_pop = mean(population_2021, na.rm = TRUE))\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  csd_type     mean_pop\n  <chr>           <dbl>\n1 city          200005.\n2 municipality   10102.\n3 town           22579.\n4 township        5367.\n5 village         1276.\n```\n\n\n:::\n:::\n\n\n\n## Ex. 7\n\nWhat is the mean population of all of the municipalities in 1996, 2001, 2006, 2011, 2016, and 2021? Try to use the across function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntowny %>%\n  summarize(across(starts_with(\"population\"), ~ mean(.x, na.rm = TRUE)))\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 6\n  population_1996 population_2001 population_2006 population_2011\n            <dbl>           <dbl>           <dbl>           <dbl>\n1          25866.          27538.          29173.          30838.\n  population_2016 population_2021\n            <dbl>           <dbl>\n1          32264.          34142.\n```\n\n\n:::\n:::\n\n\n\n## Ex. 8\n\nRun a simple t-test to see if the average population in 1996 is different from the average population in 2016.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.test(towny$population_1996, towny$population_2016, paired = TRUE)\n```\n:::\n\n\n\n. . .\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  towny$population_1996 and towny$population_2016\nt = -4.3204, df = 410, p-value = 1.956e-05\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n -9593.244 -3593.423\nsample estimates:\nmean difference \n      -6593.333 \n```\n\n\n:::\n:::\n",
    "supporting": [
      "slides-02-getting-started_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}